# __All About__

## __Installation__

The files contained in the macros folder must be copied to the
_autoload_ folder in the Aegisub directory.

The files contained in the libraries folder must be copied to the
_include_ folder in the Aegisub directory.

## __Compatibility__

_No compatibility with macOS._

The macros will only work on versions of Aegisub that have luajit and moonscript,
probably after version 3.2.x.

The macros were tested on version 3.2.2 and master v9262.

The systems tested were Windows 10 and Linux Debian 10.

On Windows they were tested on the x64 and x86 architectures, on linux only the x64 version.

The builds of the Windows _Dynamic-link library_ (.dll) were done on Windows 10.

The Linux _Shared Object_ (.so) builds were made on Debian 10.

Here are the source codes in case you want to compile new binaries.

[clipper](https://github.com/zerefxx/Lua-clipper),
[png](https://github.com/lvandeve/lodepng), 
[jpg](https://github.com/libjpeg-turbo/libjpeg-turbo), 
[gif](https://github.com/luapower/giflib)

## __Macros__

The interfaces in general have been remastered using [Aegisub master v9262](https://github.com/TypesettingTools/Aegisub).

In the macros, I have standardized a few things.

- All of their extensions have zeref.
- Almost all of them have Save and Reset buttons.
- They don't have support for Dependency Control (I don't know how I can do this).

## "_Save_ and _Reset_" Buttons

![N|Solid](images_macros/buttons.png)

Almost all macros have these two buttons.

They are important for a real-time saving and resetting of settings.

#### <span style="color:red">_Save_</span>

Saves that setting that you are currently in.

The cool thing is that the macro does not have to be closed for the save to occur.

It saves and at the same time calls the interface loading the saved settings.

The save will generate a small file that will be located in Aegisub's data folder.

#### <span style="color:red">_Reset_</span>

Extending the _Save_, the _Reset_, resets all settings saved by the _Save_.

This way you don't have to delete configuration files to get the interface
the default values of the interface.

## _"Remove selected layers?"_ Checkbox

![N|Solid](images_macros/remove.png)

In some macros you will come across this checkbox.

It simply has the power to remove the original line from the line selection,
after generating the result of the given macro.

---
### <span style="color:red">__Envelope Distort__</span>

![N|Solid](images_macros/envelope.png)

![N|Solid](images_macros/envelope_mesh.png)

As you can see, there are 2 macros inside the _Envelope Distort._

- Make with - Mesh
- Make with - Perspective

__Definition__:

>Makes Envelope and Perspective distortions on shapes and text.

### Elementos da macro _Make with - Mesh_:

#### <span style="color:red">_Control Points_</span>

This is the definition of points that will be generated in the Bounding Box.

If _Control Points_ is 1, it will return an ordinary Bounding Box, if it is greater
than 1, it will generate a recursive cut in it, doubling the amount of points.

#### <span style="color:red">_Generator_</span>

This is the definition of what kind of thing you will generate.

You only have two types of elements in that list,
the _Mesh_ and the _Warp_.

The _Mesh_, you will generate your Bounding Box in the form of an \clip,
by setting the value of _Control Points_.

The _Warp_, you will generate the transformation of the shape, from the \clip
generated by Mesh or made manually by you.

#### <span style="color:red">_Type_</span>

This is the definition of what type of Control Points will be generated.

You only have two element types in this list, the _Line_ and the _Bezier_.

If _Type_ is _Line_, it will generate line control points,
if bezier, it will generate bezier control points. 

#### <span style="color:red">_Tolerance_</span>

This is the length definition of the bezier curve.

This will define the accuracy of the bezier curve.

### _Make with - Perspective_.

As you may have noticed, the macro _Make with - Perspective_, has no interface.

It generates a perspective from the \clip generated by Mesh with the default setting of _Make with - Mesh_.

You can also make this \clip manually, keeping in mind that it must have only
four line points forming a Bounding box.

---
### <span style="color:red">__Everything Shape__</span>

![N|Solid](images_macros/every_shape.png)

__Definition__:

>Performs various operations on shapes.

### Elements of the _Everything Shape_ macro.

#### <span style="color:red">_Mode List_</span>

As the main element of the macro, the _Mode List_ defines what kind of thing
you want to do in a shape or text.

The elements contained in _Mode List_ are:

- Shape to Clip >> Transform shapes to \clip tags.
- Clip to Shape >> Transforms clip tags to shapes.
- Shape Origin >> Move shapes to the origin of the plane.
- Shape Poly >> Moves the points to the alignment 7.
- Shape Expand >> Transforms shapes according to the perspective tags (\fax, \fay...).
- Shape Smooth >> Round the edges of shapes.
- Shape Simplify >> Greatly simplify the number of points on the shapes.
- Shape Split >> Cut shapes into small pieces.
- Shape Merge >> Merge shapes from n selected lines.
- Shape Move >> Move the points of the shape.
- Shape Round >> Round the points of the shape.
- Shape Clipper >> Clip shapes from the \clip or \iclip tag.
- Text to Clip >> Transform text to \clip.
- Text to Shape >> Transforms text to a shape.

#### <span style="color:red">_Tolerance_</span>

This is the definition of various types of tolerances related to some modes.
Those not mentioned, are not part of it.

For _Shape Smooth_, it is the definition of the size of the edge rounding.

For _Shape Simplify_, it is the definition of the error size in simplification.

For _Shape Split_, it is the definition of this size divided by the actual value of the
length of the sequences of line or bezier points.

For _Shape Round_, it is the definition of the amount of decimals after the point.

#### <span style="color:red">_X - Axis e Y - Axis_</span>

This is the definition of x and y values.

These values are unique to the Shape Move element of _Mode List_.

The X axis will be moved by the _X - Axis_ box and the Y axis will be moved by the _Y - Axis_ box.

### <span style="color:red">_Botão Configure_</span>

![N|Solid](images_macros/every_shape_config.png)

Here is another interface contained within the _Everything Shape_ macro.

This one was made exclusively for configuring some elements of _Mode List_.

#### <span style="color:red">_Simplify Modes_</span>

This is the definition of what type of simplification will be used.

You only have two types of elements in this list,
the _Line_ and the _Line and Bezier_.

The _Line_ element will only simplify line points if it has bezier contained in the shape,
it will convert these bezier points to line and simplify, returning just line.

The _Line and Bezier_ element will also only simplify line points, but
instead of returning only line points, it returns a simplification of points
from line to bezier.

#### <span style="color:red">_Split Modes_</span>

This is the definition of what type of splits will be used.

The elements contained in _Split Modes_ are:

- Full >> Cuts both line and bezier points.
- Line Only >> Cuts only line points.
- Bezier Only >> Cuts only bezier points.

---
### <span style="color:red">__Gradient Cut__</span>

![N|Solid](images_macros/gradient_cut.png)

__Definition__:

>Makes a gradient on a shape or text.

### Elements of the _Gradient Cut_ macro.

#### <span style="color:red">_Gradient Types_</span>

The elements contained in _Gradient Types_ are:

- Horizontal >> Generates the gradient in the Horizontal direction.
- Vertical >> Generates the gradient in the Vertical direction.

#### <span style="color:red">_Gap Size_</span>

Sets the trim size of each layer in pixels.

#### <span style="color:red">_Accel_</span>

Sets the relative acceleration of the color interpolation.

#### <span style="color:red">_Colors_</span>

These are the color palettes that will decrementally define the gradient.

### <span style="color:red">_Botão Add+_</span>

This button will add more color palettes to the interface.

---
### <span style="color:red">__Interpolate Master__</span>

![N|Solid](images_macros/interpolate.png)

__Definition__:

>This macro makes it so that we can interpolate tag values on selected lines.

>You will have to make your desired change in the first and last row of the selection,
after that, just mark the tags you want to interpolate.

>For clip interpolation, clip interpolation with vector is available, but
both must have the same number of points.

### Elements of the _Interpolate Master_ macro.

#### <span style="color:red">_Ignore Text_</span>

You need to enable this option for cases where you have more than one tag layer.

#### <span style="color:red">_Accel_</span>

Sets the relative acceleration of the interpolation.

---
### <span style="color:red">__Stroke Panel__</span>

![N|Solid](images_macros/stroke_panel.png)

__Definition__:

>Makes a stroke or an offset around your shape or text.

### Elements of the _Stroke Panel_ macro.

#### <span style="color:red">_Stroke Corner_</span>

The elements contained in _Stroke Corner_ are:

- Miter >> It is the type of pointed corner.
- Round >> A rounded corner.
- Square >> It is the type of square corner.

#### <span style="color:red">_Aligin Stroke_</span>

The elements contained in _Stroke Corner_ are:

- Center >> Generates the outline in the center of the edges of the shape.
- Inside >> Generates the outline inside the edges of the shape.
- Outside >> Generates the outline outside the edges of the shape.

#### <span style="color:red">_Stroke Weight_</span>

This is the size of the stroke.

#### <span style="color:red">_Miter Limit_</span>

[Miter Limit](http://www.angusj.com/delphi/clipper/documentation/Docs/Units/ClipperLib/Classes/ClipperOffset/Properties/MiterLimit.htm)

#### <span style="color:red">_Arc Tolerance_</span>

[Arc Tolerance](http://www.angusj.com/delphi/clipper/documentation/Docs/Units/ClipperLib/Classes/ClipperOffset/Properties/ArcTolerance.htm)

#### <span style="color:red">_Primary Color_</span>

This is the primary color, equivalent to \1c.

#### <span style="color:red">_Stroke Color_</span>

It is the stroke color, equivalent to \3c.

#### <span style="color:red">_Generate only offset?_</span>

If checked, returns only the offset.

---
### <span style="color:red">__Text in Clip__</span>

![N|Solid](images_macros/text_in_clip.png)

__Definition__:

>Makes the text characters wrap around the clip.

#### <span style="color:red">_Modes_</span>

The elements contained in _Modes_ are:

- Center >> Generates an aligned output in the center of the clip.
- Left >> Generates an output aligned on the left of the clip.
- Right >> Generates an output aligned to the right of the clip.
- Around >> Generate an output aligned around the clip.
- Animated - Start to End >> Generates an animation from the start to end of the clip.
- Animated - End to Start >> Generates an animation from the end to start of the clip.

#### <span style="color:red">_Offset_</span>

If the modes are non-animated, the offset value will be equivalent
to a position offset, if they are animation, the offset value will be
equivalent to the frame duration step.

---
### <span style="color:red">__Image Trace__</span>

![N|Solid](images_macros/image_tracer.png)

__Definition__:

>Transforms images into shapes in a custom way.

#### <span style="color:red">_Preset_</span>

The elements contained in _Preset_ are:

- Custom >> Mode that allows you to freely customize the values.
- Default >> Default mode of the trace.
- Detailed >> Mode that can make the traces more detailed.
- Black and White >> Mode that returns the colors to black and white only.
- Grayscale >> Mode that returns the colors in grayscale.
- 3 Colors >> Mode that returns the 3 most extensive colors in the image.
- 6 Colors >> Mode that returns the 6 most extensive colors in the image.
- 16 Colors >> Mode that returns the 16 most extensive colors in the image.
- Smoothed >> Mode that returns the smoothest traces.

#### <span style="color:red">_Mode_</span>

The elements contained in _Mode_ are:

- Custom >> Mode that allows you to freely customize the values.
- Color >> It is based on a _Pellete_ deterministic: rectangular grid.
- Black and White >>Based on the _Pellete_ of colors defined by the number of colors and limited to 2 colors.
- Grayscale >> Based on the _Pellete_ of colors defined by the number of colors and limited to 7 colors.

#### <span style="color:red">_Pallete_</span>

The elements contained in _Pallete_ are:

- Sampling >> Generates a _Pallete_ from random values.
- Rectangular Grid >> Generates a _Pallete_ deterministic: rectangular grid.
- Number of colors >> Generates a _Pallete_ from the number of colors defined.

#### <span style="color:red">_Number of Colors_</span>

Sets the number of the colors that will be mapped in the image.

#### <span style="color:red">_Min Color Ratio_</span>

Sets the minimum amount of ratio, for cases where they have few pixels.

#### <span style="color:red">_Color Quant Cycles_</span>

Sets the amount of cycles in quantization processing.

#### <span style="color:red">_Right Angle ENH?_</span>

Sets whether you want right angle enhancement in path interpolation.

#### <span style="color:red">_Line Tres_</span>

Sets the "error minima" (precision) of line values.

#### <span style="color:red">_Bezier Tres_</span>

Sets the "error minimo" (precision) of the bezier values.

#### <span style="color:red">_Pathomit_</span>

Sets the removal of paths from this value.

#### <span style="color:red">_Round_</span>

Sets the amount of decimals after the dot.

#### <span style="color:red">_Stroke Size_</span>

Sets the size of the stroke.

#### <span style="color:red">_Scale_</span>

Sets the scale of the shape, 1 equals 100%.

#### <span style="color:red">_Blur Radius_</span>

Sets the radius of the blur, which can be up to 5.

#### <span style="color:red">_Blur Delta_</span>

Sets the delta of the blur, which can be up to 1024.

If the difference between the pixel with blur and the pixel without blur
is greater than delta, returns the original value of the pixel.

#### <span style="color:red">_Ignore White?_</span>

Makes it remove the white colored parts.

#### <span style="color:red">_Ignore Black?_</span>

Makes it remove the black colored parts.

---
## __Libraries__

Most of the relevant things here were done by other people.

I'll leave the original repositories from where I got access to them.

#### <span style="color:red">_img_libs_</span>

- [png, jpg, buffer](https://github.com/koreader/koreader-base/tree/master/ffi)
- [bmp](https://github.com/max1220/lua-bitmap)
- [gif](https://luapower.com/giflib)
- [image_tracer](https://github.com/jankovicsandras/imagetracerjs)

#### <span style="color:red">_others_</span>

- [Yutils](https://github.com/Youka/Yutils)
- [requireffi](https://github.com/TypesettingTools/ffi-experiments/tree/master/requireffi)
- [clipper](https://github.com/zerefxx/Lua-clipper)

#### <span style="color:red">_ZF/utils_</span>

This is where the main functions used in macros are stored.

Here is the list of classes and methods present in them at the moment.

   - <span style="color:red">class MATH</span>
      - new: =>
      - round: (x, dec) =>
      - distance: (x1, y1, x2, y2) => 
      - interpolation: (pct, min, max) =>
<br><br>
   - <span style="color:red">class TABLE</span>
      - new: (t) =>
      - copy: =>
      - map: (fn) =>
      - slice: (f, l, s) =>
      - push: (...) =>
      - concat: (...) =>
      - reduce: (fn, init) =>
      - view: (table_name, indent) =>
<br><br>
   - <span style="color:red">class l2b</span>
      - new: =>
      - polyline2bezier: (polyline, ____error) =>
      - solution: (shape, dist, ____error) =>
<br><br>
   - <span style="color:red">class l2l</span>
      - new: =>
      - simplify: (points, tolerance, highestQuality, closed) =>
      - solution: (points, tolerance, highestQuality, closed) =>
<br><br>
   - <span style="color:red">class BEZIER</span>
      - new: (...) =>
      - line: (t, b0, b1) =>
      - quadratic: (t, b0, b1, b2) =>
      - cubic: (t, b0, b1, b2, b3) =>
      - bernstein: (t, i, n) =>
      - create: (len) =>
      - len: (steps) =>
<br><br>
   - <span style="color:red">class SHAPER</span>
      - new: (shape, closed) =>
      - split: (size, seg, len_t) =>
      - bounding: (shaper) =>
      - info: =>
      - filter: (fils) =>
      - displace: (px, py) =>
      - scale: (sx, sy) =>
      - rotate: (angle, cx, cy) =>
      - origin: (min) =>
      - org_points: (an) =>
      - to_clip: (an, px, py) =>
      - unclip: (an, px, py) =>
      - perspective: (destin) =>
      - to_bezier: =>
      - envelop_distort: (ctrl_p1, ctrl_p2) =>
      - expand: (line, meta) =>
      - smooth_edges: (radius) =>
      - build: (typer, dec) =>
<br><br>
   - <span style="color:red">class POLY</span>
      - new: =>
      - to_points: (shape, scale) =>
      - to_shape: (points, rescale) =>
      - create_path: (path) =>
      - create_paths: (paths) =>
      - simplify: (paths, ass, tol, sp) =>
      - clean: (paths, sp) =>
      - get_solution: (path, rescale) =>
      - clipper: (sbj, clp, ft, ct, sp) =>
      - offset: (points, size, jt, et, mtl, act, sp) =>
      - to_outline: (points, size, jt, mode, mtl, act) =>
      - clip: (subj, clip, x, y, iclip) =>
<br><br>
   - <span style="color:red">class TEXT</span>
      - new: =>
      - to_shape: (line, text) =>
      - to_clip: (line, text, an, px, py) =>
<br><br>
   - <span style="color:red">class SUPPORT</span>
      - new: =>
      - interpolation: (pct, tp, ...) =>
      - tags2styles: (subs, line) =>
      - find_coords: (line, meta, ogp) =>
      - html_color: (color, mode) =>
      - clip_to_draw: (clip) =>
<br><br>
   - <span style="color:red">class CONFIG</span>
      - new: =>
      - file_exist: (file, dir) =>
      - read: (filename) =>
      - load: (GUI, macro_name) =>
      - save: (GUI, elements, macro_name, macro_version) =>
<br><br>
   - <span style="color:red">class TAGS</span>
      - new: (tags) =>
      - find: =>
      - clean: (text) =>
      - remove: (modes, tags) =>

Inside the <span style="color:red">_ZF/utils_</span> library there are also some extraneous libraries.

   - [polyline2bezier](https://github.com/ynakajima/polyline2bezier)
   - [simplify-js](https://github.com/mourner/simplify-js)

For more information, access the source code.

Any questions you can call me at discord _Zeref#8844_, I just don't guarantee to answer quickly.

[![License: MIT](https://img.shields.io/badge/License-MIT-red.svg)](https://opensource.org/licenses/MIT)